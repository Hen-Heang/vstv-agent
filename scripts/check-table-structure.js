#!/usr/bin/env node

console.log('üîç Checking Supabase table structure...\n');

console.log('üìã To fix the "column position does not exist" error:');
console.log('');
console.log('1. üóÑÔ∏è Go to your Supabase SQL Editor:');
console.log('   https://stofwehocrbkrjphogiy.supabase.co');
console.log('');
console.log('2. üìù Copy and paste this SQL to recreate the table:');
console.log('');
console.log('```sql');
console.log('-- Drop existing table if it has issues');
console.log('DROP TABLE IF EXISTS agents CASCADE;');
console.log('');
console.log('-- Create the agents table with correct structure');
console.log('CREATE TABLE agents (');
console.log('  id TEXT PRIMARY KEY,');
console.log('  name TEXT NOT NULL,');
console.log('  email TEXT UNIQUE NOT NULL,');
console.log('  phone TEXT,');
console.log('  telegram TEXT,');
console.log('  position TEXT,');
console.log('  bio TEXT,');
console.log('  avatar_url TEXT,');
console.log('  background_image TEXT DEFAULT \'/images/company/VSTV-BG.png\',');
console.log('  specialties TEXT[] DEFAULT \'{}\',');
console.log('  languages TEXT[] DEFAULT \'{}\',');
console.log('  experience_years INTEGER DEFAULT 0,');
console.log('  properties_sold INTEGER DEFAULT 0,');
console.log('  rating DECIMAL(2,1) DEFAULT 0.0,');
console.log('  education TEXT,');
console.log('  certifications TEXT[] DEFAULT \'{}\',');
console.log('  achievements TEXT[] DEFAULT \'{}\',');
console.log('  location TEXT DEFAULT \'Phnom Penh\',');
console.log('  is_active BOOLEAN DEFAULT true,');
console.log('  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),');
console.log('  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()');
console.log(');');
console.log('');
console.log('-- Create indexes');
console.log('CREATE INDEX idx_agents_is_active ON agents(is_active);');
console.log('CREATE INDEX idx_agents_position ON agents(position);');
console.log('CREATE INDEX idx_agents_rating ON agents(rating);');
console.log('');
console.log('-- Enable RLS');
console.log('ALTER TABLE agents ENABLE ROW LEVEL SECURITY;');
console.log('');
console.log('-- Create policies');
console.log('CREATE POLICY "Allow public read access to active agents" ON agents');
console.log('  FOR SELECT USING (is_active = true);');
console.log('');
console.log('CREATE POLICY "Allow authenticated users to manage agents" ON agents');
console.log('  FOR ALL USING (auth.role() = \'authenticated\');');
console.log('```');
console.log('');
console.log('3. ‚ñ∂Ô∏è Click "Run" to execute the SQL');
console.log('');
console.log('4. üå± Then run: npm run seed:agents');
console.log('');
console.log('5. ‚úÖ Test with: npm run dev');
console.log('');
console.log('üéâ This will fix the column structure issue!');
